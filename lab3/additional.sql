CREATE TABLE CUSTOMER (
    cust# INT PRIMARY KEY,
    cname VARCHAR(50),
    city VARCHAR(30)
);

CREATE TABLE ORDERS (
    order# INT PRIMARY KEY,
    odate DATE,
    cust# INT,
    ordamt INT,
    FOREIGN KEY (cust#) REFERENCES CUSTOMER(cust#)
);

CREATE TABLE ITEM (
    item# INT PRIMARY KEY,
    unitprice INT
);

CREATE TABLE ORDER_ITEMS (
    order# INT,
    qty INT,
    item# INT,
    PRIMARY KEY (order#, item#),
    FOREIGN KEY (order#) REFERENCES ORDERS(order#),
    FOREIGN KEY (item#) REFERENCES ITEM(item#)
);

CREATE TABLE SHIPMENT (
    order# INT,
    warehouse# INT,
    shipdate DATE,
    PRIMARY KEY (order#),
    FOREIGN KEY (order#) REFERENCES ORDERS(order#)
);

CREATE TABLE WAREHOUSE (
    warehouse# INT PRIMARY KEY,
    city VARCHAR(30)
);

INSERT INTO CUSTOMER VALUES (1, 'Customer1', 'City1');
INSERT INTO CUSTOMER VALUES (2, 'Customer2', 'City2');
INSERT INTO CUSTOMER VALUES (3, 'Customer3', 'City3');
INSERT INTO CUSTOMER VALUES (4, 'Customer4', 'City1');
INSERT INTO CUSTOMER VALUES (5, 'Customer5', 'City2');

INSERT INTO ORDERS VALUES (101, TO_DATE('2024-01-01', 'YYYY-MM-DD'), 1, 1000);
INSERT INTO ORDERS VALUES (102, TO_DATE('2024-01-02', 'YYYY-MM-DD'), 2, 1500);
INSERT INTO ORDERS VALUES (103, TO_DATE('2024-01-03', 'YYYY-MM-DD'), 3, 1200);
INSERT INTO ORDERS VALUES (104, TO_DATE('2024-01-04', 'YYYY-MM-DD'), 4, 800);
INSERT INTO ORDERS VALUES (105, TO_DATE('2024-01-05', 'YYYY-MM-DD'), 5, 2000);

INSERT INTO ITEM VALUES (1, 50);
INSERT INTO ITEM VALUES (2, 75);
INSERT INTO ITEM VALUES (3, 30);
INSERT INTO ITEM VALUES (4, 100);
INSERT INTO ITEM VALUES (5, 45);

INSERT INTO ORDER_ITEMS VALUES (101, 5, 1);
INSERT INTO ORDER_ITEMS VALUES (101, 3, 2);
INSERT INTO ORDER_ITEMS VALUES (102, 2, 1);
INSERT INTO ORDER_ITEMS VALUES (103, 4, 3);
INSERT INTO ORDER_ITEMS VALUES (104, 1, 4);

INSERT INTO SHIPMENT VALUES (101, 1, TO_DATE('2024-01-05', 'YYYY-MM-DD'));
INSERT INTO SHIPMENT VALUES (102, 2, TO_DATE('2024-01-06', 'YYYY-MM-DD'));
INSERT INTO SHIPMENT VALUES (103, 3, TO_DATE('2024-01-07', 'YYYY-MM-DD'));
INSERT INTO SHIPMENT VALUES (104, 1, TO_DATE('2024-01-08', 'YYYY-MM-DD'));
INSERT INTO SHIPMENT VALUES (105, 2, TO_DATE('2024-01-09', 'YYYY-MM-DD'));

INSERT INTO WAREHOUSE VALUES (1, 'City1');
INSERT INTO WAREHOUSE VALUES (2, 'City2');
INSERT INTO WAREHOUSE VALUES (3, 'City3');
INSERT INTO WAREHOUSE VALUES (4, 'City4');
INSERT INTO WAREHOUSE VALUES (5, 'City5');

--a)
SELECT
    c.cname AS CUSTNAME,
    COUNT(o.order#) AS "No. of Orders",
    AVG(o.ordamt) AS AVG_ORDER_AMT
FROM
    CUSTOMER c
    JOIN ORDERS o ON c.cust# = o.cust#
GROUP BY
    c.cname;

--b)

SELECT DISTINCT o.order#
FROM
    ORDERS o
    JOIN SHIPMENT s ON o.order# = s.order#
    JOIN WAREHOUSE w ON s.warehouse# = w.warehouse#
WHERE
    w.city = 'YourCity'; -- Replace 'YourCity' with the desired city

--c)
UPDATE ORDERS
SET ordamt = 
    CASE
        WHEN EXISTS (
            SELECT 1
            FROM ORDER_ITEMS oi
            WHERE oi.order# = ORDERS.order#
              AND oi.qty > 10
        ) THEN ordamt * 0.9
        ELSE ordamt * 0.95
    END;

--d)